<!DOCTYPE html>

<html>

	<head>
		<title>My First Website</title>
		<link rel="stylesheet" href=style.css>
		<meta name="viewport" content="width=device-width,initial-scale=1">
	</head>

	<body class="element-with-background">

		<h1 class="gradient-text">
  			HAPPY NEW YEAR!
		</h1>

		<h2>This is a real webpage.</h2>

		<p>
			<label for="picture">Take a picture using back facing camera:</label>
			<input id="photo_input" type="file" accept="image/*" capture="environment">
		</p>
	

		<p>
			<img id="thumbnail" width="200">
		</p>


		<p>
      		<button id="upload_btn" disabled>Upload + Analyze</button>
    		</p>


  	  	<pre id="result"></pre>


		<p>Look at this cute puppy (not as cute as donner though)</p>
		<img src="https://picsum.photos/id/237/500/500"/>
		<p>For reference, this is donner</p>
		<img src="IMG_0629.jpeg"/>


	<script>
      let jpegBlob = null;

      photo_input.onchange = () => {
        result.textContent = "";
        upload_btn.disabled = true;
        jpegBlob = null;

        const img = new Image();
        img.onload = () => {
          const c = Object.assign(document.createElement("canvas"), {
            width: img.width,
            height: img.height
          });
          c.getContext("2d").drawImage(img, 0, 0);

          // Convert whatever was selected (HEIC/PNG/etc.) into a JPEG blob.
          c.toBlob(b => {
            jpegBlob = b;
            thumbnail.src = URL.createObjectURL(b);
            upload_btn.disabled = false;
          }, "image/jpeg");
        };
        img.src = URL.createObjectURL(photo_input.files[0]);
      };

      upload_btn.onclick = async () => {
        if (!jpegBlob) {
          result.textContent = "No JPEG ready yet.";
          return;
        }

        result.textContent = "Uploadingâ€¦";

        const form = new FormData();
        // Field name must be "file" to match your Flask handler.
        form.append("file", jpegBlob, "photo.jpg");

        try {
          const res = await fetch("/upload", {
            method: "POST",
            body: form
          });

          const text = await res.text();
          if (!res.ok) {
            result.textContent = "Server error:\n" + text;
            return;
          }

          result.textContent = text;
        } catch (e) {
          result.textContent = "Network error: " + e;
        }
      };
    </script>


	</body>

</html>